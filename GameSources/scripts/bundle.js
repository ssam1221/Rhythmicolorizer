(()=>{"use strict";class t{constructor({filename:t}){this.filename=t}getFormattedDate(){const t=new Date;return`[${t.getFullYear()}/${("00"+(t.getMonth()+1)).substr(-2)}/${("00"+t.getDate()).substr(-2)} ${("00"+(t.getHours()+1)).substr(-2)}:${("00"+(t.getMinutes()+1)).substr(-2)}:${("00"+(t.getSeconds()+1)).substr(-2)}]`}log(...t){const e=`                         ${this.filename}`.substr(-20);console.log(`${this.getFormattedDate()}[${e}] `,...t)}}const e=new t({filename:"BGMSelector"});class s{static selectedIdx=0;static BGMData={};static async initialize(){e.log("Initializing..."),this.BGMData=await(await fetch("data/BGMList.json")).json();for(const t in this.BGMData)this.BGMData[t].coverImage=this.getCoverImage(t);e.log("BGM Data : ",this.BGMData)}static getCoverImage(t){return`/data/coverImages/${t}.png`}static getBGMListInfo(){return this.BGMData}static onBGMSelected(t){"ArrowLeft"===t.key?(this.selectedIdx=(this.BGMData.length+this.selectedIdx-1)%this.BGMData.length,e.log(`Selected title : [${this.selectedIdx}] ${this.BGMData[this.selectedIdx].title}`)):"ArrowRight"===t.key?(this.selectedIdx=(this.selectedIdx+1)%this.BGMData.length,e.log(`Selected title : [${this.selectedIdx}] ${this.BGMData[this.selectedIdx].title}`)):"Enter"!==t.key&&" "!==t.key||e.log("Selected")}}const i=new t({filename:"BGMPlayer"});class a{static currentBGM="";static player;static initialize(){}static async setVideo(t){const e=this;return new Promise(((a,n)=>{i.log(`SetVideo : [${t}]`);const o=(()=>{for(const e of s.getBGMListInfo())if(e.title===t)return e})();i.log(o),e.player=new YT.Player("youtubeVideoPlayer",{height:"800",width:"800",videoId:o.data.youtube,playerVars:{controls:0},events:{onReady:function(t){console.log("onPlayerReady : ",t),t.target.playVideo()},onStateChange:function(t){console.log("onPlayerStateChange ",t),t.data===YT.PlayerState.PLAYING&&a({play:()=>{t.target.playVideo()}})}}})}))}static play(){this.player.playVideo()}}const n=new t({filename:"NoteCreator"});class o{static MUSIC_NOTE_CLASS_NAME="MUSIC_NOTE";static PRESSED_CLASS_NAME="PRESSED_NOTE";static MAX_KEYPRESS_NOTES=100;static KEYPRESS_FPS=1e3/this.MAX_KEYPRESS_NOTES;static currentKeyPressNoteIndex=0;static keypressDivInterval;static isPaused=!1;static noteList=[];static musicNoteList=[];static keypressNotes=[];static timeoutFunctionList=[];static keynotesContainer=null;static pressedkeynotesContainer=null;static StartTime=null;static PointCheck={Perfect:0,Good:0,Bad:0,Miss:0};static initialize(){n.log("Initializing..."),this.keynotesContainer=document.getElementById("keynotesContainer"),this.pressedkeynotesContainer=document.getElementById("keynotePressedContainer"),this.createkeypressNotes(),this.keypressDivInterval=setInterval((()=>{this.currentKeyPressNoteIndex=++this.currentKeyPressNoteIndex%this.MAX_KEYPRESS_NOTES}),this.KEYPRESS_FPS)}static async setNotes(t){n.log(`Set notes for title : [${t}]...`),this.noteList=await(await fetch(`data/notes/${t}.json`)).json()}static createkeypressNotes(){for(let t=0;t<this.MAX_KEYPRESS_NOTES;t++){const e=document.createElement("div");e.id=`musicNote_${t}`,e.setAttribute("class",this.MUSIC_NOTE_CLASS_NAME),this.keynotesContainer.appendChild(e);const s=document.createElement("div");s.id=`keypressNote_${t}`,s.setAttribute("class",this.PRESSED_CLASS_NAME),this.pressedkeynotesContainer.appendChild(s)}}static add({what:t,timestamp:e}){}static read(){}static create(){}static pop(){this.StartTime.getTime(),(new Date).getTime()}static async start(){n.log("Start to create notes..."),await this.setNotes("A Fallen Leaf");for(const t of this.noteList)(t=>{this.timeoutFunctionList.push(setTimeout((()=>{this.renderMusicNote(t.key)}),t.timestamp))})(t);this.StartTime=new Date}static stop(){for(const t of this.timeoutFunctionList)clearTimeout(t)}static renderMusicNote(t){(t=>{const e=document.getElementById(`musicNote_${this.currentKeyPressNoteIndex}`);e.innerText=t,e.setAttribute("class",`${this.MUSIC_NOTE_CLASS_NAME} showNote`),setTimeout((()=>{e.setAttribute("class",`${this.MUSIC_NOTE_CLASS_NAME}`),e.innerText=""}),1e3),n.log(t)})(t)}static keypressNote(t){(t=>{const e=document.getElementById(`keypressNote_${this.currentKeyPressNoteIndex}`);n.log(`keypressNote : [${t}] : Assigned to : ${this.currentKeyPressNoteIndex}`),e.innerText=t,e.setAttribute("class",`${this.PRESSED_CLASS_NAME} showNote`)})(t)}static checkPressedKeyCorrected(t){}static onkeypress(t){1===t.key.length&&this.keypressNote(t.key)}}class r{static _currentMode="";static get getCurrentMode(){return this._currentMode}static setCurrentMode(t){this._currentMode=t}static addKeyboardEventListener(){document.addEventListener("keydown",(t=>{switch(this._currentMode){case"":case"MainMenu":case"Loading":break;case"SelectBGM":s.onBGMSelected(t);break;case"GamePlaying":o.onkeypress(t)}}))}}window.onload=async()=>{const e=new t({filename:"MainPlayer"});e.log("Start"),await a.initialize(),await s.initialize(),o.initialize(),e.log(s.getBGMListInfo()),r.setCurrentMode("GamePlaying"),r.addKeyboardEventListener(),document.onclick=async()=>{(await a.setVideo("두근두근! 드디어!! 대모험 시작!!!")).play()},o.start()}})();