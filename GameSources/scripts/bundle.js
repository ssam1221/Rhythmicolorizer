(()=>{"use strict";let t=null;class e{constructor({filename:t}){this.filename=t}static setDebugMode(e){console.log(`Set debug mode to : ${e}`),t=e}getFormattedDate(){const t=new Date;return`[${t.getFullYear()}/${("00"+(t.getMonth()+1)).substr(-2)}/${("00"+t.getDate()).substr(-2)} ${("00"+(t.getHours()+1)).substr(-2)}:${("00"+(t.getMinutes()+1)).substr(-2)}:${("00"+(t.getSeconds()+1)).substr(-2)}]`}info(...t){const e=`                         ${this.filename}`.substr(-20);console.info(`[ INFO]${this.getFormattedDate()}[${e}] `,...t)}warn(...t){const e=`                         ${this.filename}`.substr(-20);console.warn(`[ WARN]${this.getFormattedDate()}[${e}] `,...t)}error(...t){const e=`                         ${this.filename}`.substr(-20);console.error(`[ERROR]${this.getFormattedDate()}[${e}] `,...t)}log(...t){const e=`                         ${this.filename}`.substr(-20);console.log(`[  LOG]${this.getFormattedDate()}[${e}] `,...t)}}const s=new e({filename:"BGMDatabase"});class i{static BGMDataList={};static player;static async initialize(){try{s.log("Initializing..."),this.BGMDataList=await(await fetch("data/BGMList.json")).json();for(let t=0;t<this.BGMDataList.length;t++){const e=this.BGMDataList[t];this.BGMDataList[t].coverImage=this.getCoverImage(e.title);const i=await(await fetch(`data/notes/${e.title}.json`)).json();this.BGMDataList[t].data.noteList=i,s.log(`Loading [${e.title}]...`)}s.log("BGM Data : ",this.BGMDataList)}catch(t){s.error(t)}}static getCoverImage(t){return`data/coverImages/${t}.png`}static getDataByTitle(t){for(const e of this.BGMDataList)if(e.title===t)return e;return null}static getDataByIndex(t){return this.BGMDataList[t]}}const a=new e({filename:"BGMSelector"});class n{static selectedIdx=0;static BGMData={};static async initialize(){a.log("Initializing..."),this.BGMData=await(await fetch("data/BGMList.json")).json();for(const t in this.BGMData)this.BGMData[t].coverImage=i.getCoverImage(t)}static getBGMListInfo(){return this.BGMData}static onBGMSelected(t){"ArrowLeft"===t.key?(this.selectedIdx=(this.BGMData.length+this.selectedIdx-1)%this.BGMData.length,a.log(`Selected title : [${this.selectedIdx}] ${this.BGMData[this.selectedIdx].title}`)):"ArrowRight"===t.key?(this.selectedIdx=(this.selectedIdx+1)%this.BGMData.length,a.log(`Selected title : [${this.selectedIdx}] ${this.BGMData[this.selectedIdx].title}`)):"Enter"!==t.key&&" "!==t.key||a.log("Selected")}}class o{static SfxPlayerContainer;static NUM_AUDIO_TAG=100;static AudioTags=[];static currentAudioTagIndex=0;static initialize(){this.SfxPlayerContainer=document.getElementById("sfxPlayerContainer");for(let t=0;t<this.NUM_AUDIO_TAG;t++){const e=document.createElement("audio");e.id=`SFXPlayer_${t}`,e.setAttribute="SFXPlayer",this.SfxPlayerContainer.appendChild(e),this.AudioTags[t]=e}}static play(t){"string"==typeof t&&(this.AudioTags[this.currentAudioTagIndex].src=t,this.AudioTags[this.currentAudioTagIndex].play(),this.currentAudioTagIndex=++this.currentAudioTagIndex%this.NUM_AUDIO_TAG)}}const r=new e({filename:"NoteCreator"});class c{static Difficulty={EASY:"Easy",NORMAL:"Normal",HARD:"Hard"};static currentDifficulty="";static MUSIC_NOTE_CLASS_NAME="MUSIC_NOTE";static PRESSED_CLASS_NAME="PRESSED_NOTE";static MAX_KEYPRESS_NOTES=100;static KEYPRESS_FPS=1e3/this.MAX_KEYPRESS_NOTES;static currentNoteIndex=0;static currentKeyPressNoteIndex=0;static NOTE_SPEED=2;static NOTE_ACTIVATING_TIMESTAMP=1300;static NOTE_SHOWING_TIMESTAMP=1e3*this.NOTE_SPEED;static NOTE_CHECK_DELAY_TIMESTAMP=1200;static keypressDivInterval;static isPaused=!1;static noteList=[];static musicNoteList=[];static keypressNotes=[];static timeoutFunctionList=[];static activateNoteList=[];static keynotesContainer=null;static pressedkeynotesContainer=null;static StartTime=null;static NOTE_STATUS={IDLE:"Idle",SHOWING:"Showing",ACTIVATING:"Activating",USED:"Used"};static NOTE_SIZE={HEIGHT:"128px"};static NOTE_POSITION={"`1234567890-=\\~!@#$%^&*()_+|":0,"qwertyuiop[]QWERTYUIOP{}":1,"asdfghjkl;'ASDFGHJKL:\"":2,"zxcvbnm,./ZXCVBNM<>?":3};static PointCheck={Perfect:0,Good:0,Bad:0,Miss:0};static initialize(){r.log("Initializing..."),this.keynotesContainer=document.getElementById("keynotesContainer"),this.pressedkeynotesContainer=document.getElementById("keynotePressedContainer"),this.createkeypressNotes()}static getCurrentNoteIndex(){return this.currentNoteIndex=++this.currentNoteIndex%this.MAX_KEYPRESS_NOTES,this.currentNoteIndex}static getCurrentKeyPressNoteIndex(){return this.currentKeyPressNoteIndex=++this.currentKeyPressNoteIndex%this.MAX_KEYPRESS_NOTES,this.currentKeyPressNoteIndex}static getCurrentDifficulty(){return this.currentDifficulty}static setNotes(t,e){r.log(`Set notes for title : [${e}][${t}]...`),this.noteList=i.getDataByTitle(t).data.noteList[e];for(let t=0;t<this.noteList.length;t++)this.noteList[t].status=this.NOTE_STATUS.IDLE;this.currentDifficulty=e,document.getElementById("Difficulty").innerHTML=`Difficulty : ${e}`,r.log("Notes : ",this.noteList)}static createkeypressNotes(){for(let t=0;t<this.MAX_KEYPRESS_NOTES;t++){const e=document.createElement("div");e.id=`musicNote_${t}`,e.setAttribute("class",this.MUSIC_NOTE_CLASS_NAME),this.keynotesContainer.appendChild(e);const s=document.createElement("div");s.id=`keypressNote_${t}`,s.setAttribute("class",this.PRESSED_CLASS_NAME),this.pressedkeynotesContainer.appendChild(s)}}static add({what:t,timestamp:e}){}static read(){}static create(){}static pop(){this.StartTime.getTime(),(new Date).getTime()}static async start(){const t=this;r.log("Start to create notes..."),r.log(`Note create delay : ${t.NOTE_CHECK_DELAY_TIMESTAMP}`),this.setNotes("두근두근! 드디어!! 대모험 시작!!!",this.Difficulty.NORMAL);for(const e of this.noteList)(e=>{this.timeoutFunctionList.push(setTimeout((()=>{this.renderMusicNote(e.key),e.status=t.NOTE_STATUS.SHOWING,setTimeout((()=>{e.status=t.NOTE_STATUS.ACTIVATING}),t.NOTE_ACTIVATING_TIMESTAMP),setTimeout((()=>{e.status=t.NOTE_STATUS.USED}),t.NOTE_SHOWING_TIMESTAMP)}),e.timestamp-t.NOTE_CHECK_DELAY_TIMESTAMP))})(e);this.StartTime=new Date}static stop(){this.noteList=[];for(const t of this.timeoutFunctionList)clearTimeout(t)}static setNotePosition(t){const e=t.innerText;for(const s in this.NOTE_POSITION)if(s.indexOf(e)>-1){const e=160*this.NOTE_POSITION[s];t.setAttribute("position",this.NOTE_POSITION[s]),t.style.top=`calc(50% - ${320-e}px`;break}}static renderMusicNote(t){const e=this;(t=>{const s=document.getElementById(`musicNote_${this.getCurrentNoteIndex()}`);s.innerText=t,this.setNotePosition(s),s.setAttribute("class",`${this.MUSIC_NOTE_CLASS_NAME} showNote`),setTimeout((()=>{s.setAttribute("class",`${this.MUSIC_NOTE_CLASS_NAME}`),s.innerText=""}),e.NOTE_SHOWING_TIMESTAMP)})(t)}static keypressNote(t){o.play("./data/sfx/hat.mp3"),(t=>{const e=document.getElementById(`keypressNote_${this.getCurrentKeyPressNoteIndex()}`);e.innerText=t,this.setNotePosition(e),e.setAttribute("class",`${this.PRESSED_CLASS_NAME} showNote`),this.checkPressedKeyCorrected(t),setTimeout((()=>{e.setAttribute("class",`${this.PRESSED_CLASS_NAME}`),e.innerText=""}),1e3)})(t)}static checkPressedKeyCorrected(t){const e=(new Date).getTime()-this.StartTime;r.log(`Key pressed ${t} with timestamp : ${e}`),this.currentKeyPressNoteIndex}static onkeypress(t){!0===d.isGameStart&&1===t.key.length&&this.keypressNote(t.key)}}const l=new e({filename:"BGMPlayer"});class d{static currentBGM="";static isBGMStart=!1;static isGameStart=!1;static player;static Containers={Difficulty:null,GetReadyText:null,keynotesContainers:null,keynotesContainerBackground:null,keynoteChecker:null};static initialize(){this.Containers.Difficulty=document.getElementById("Difficulty"),this.Containers.GetReadyText=document.getElementById("getReadyText"),this.Containers.keynotesContainerBackground=document.getElementById("keynotesContainerBackground"),this.Containers.keynoteChecker=document.getElementById("keynoteChecker"),this.Containers.keynotesContainers=document.getElementsByClassName("keynotesContainer")}static setVideo(t,e){const s=this;l.log(`SetVideo : [${t}]`);const a=i.getDataByTitle(t);l.log(a),s.player=new YT.Player("youtubeVideoPlayer",{height:"800",width:"800",videoId:a.data.youtube,playerVars:{controls:0},events:{onReady:function(t){s.player.playVideo()},onStateChange:async function(t){!1===s.isBGMStart&&(s.isBGMStart=!0,s.player.stopVideo(),await new Promise(((t,e)=>{s.Containers.GetReadyText.innerHTML="Get<br>Ready?",o.play("data/sfx/voice/get_ready.wav"),s.Containers.GetReadyText.setAttribute("class","GetReadyAnimation"),setTimeout((()=>{s.Containers.GetReadyText.setAttribute("class",""),o.play("data/sfx/voice/three.wav"),s.Containers.GetReadyText.innerHTML="3",setTimeout((()=>{s.Containers.GetReadyText.setAttribute("class","GetReadyAnimation")}))}),1e3),setTimeout((()=>{s.Containers.GetReadyText.setAttribute("class",""),o.play("data/sfx/voice/two.wav"),s.Containers.GetReadyText.innerHTML="2",setTimeout((()=>{s.Containers.GetReadyText.setAttribute("class","GetReadyAnimation")}))}),2e3),setTimeout((()=>{s.Containers.GetReadyText.setAttribute("class",""),o.play("data/sfx/voice/one.wav"),s.Containers.GetReadyText.innerHTML="1",setTimeout((()=>{s.Containers.GetReadyText.setAttribute("class","GetReadyAnimation")}))}),3e3),setTimeout((()=>{s.Containers.GetReadyText.setAttribute("class",""),o.play("data/sfx/voice/start.wav"),s.Containers.GetReadyText.innerHTML="Start!",setTimeout((()=>{s.Containers.GetReadyText.setAttribute("class","GetReadyAnimation")}))}),4e3),setTimeout((()=>{const e=s.Containers.keynotesContainerBackground.getAttribute("class"),i=s.Containers.keynoteChecker.getAttribute("class"),a=s.Containers.keynotesContainers[0].getAttribute("class");s.Containers.keynoteChecker.setAttribute("class",`${i} transparentFadeIn`),s.Containers.Difficulty.style.opacity=1,s.Containers.keynotesContainerBackground.setAttribute("class",`${e} transparentFadeIn`);for(const t of s.Containers.keynotesContainers)t.setAttribute("class",`${a} transparentFadeIn`);setTimeout((()=>{s.Containers.keynotesContainerBackground.style.opacity=.2,s.Containers.keynoteChecker.style.opacity=.2;for(const t of s.Containers.keynotesContainers)t.style.opacity=.2})),s.Containers.GetReadyText.setAttribute("class",""),s.Containers.GetReadyText.innerHTML="",t()}),5e3)})),l.log("self.isBGMStart ",s.isBGMStart),s.isGameStart=!0,console.log(YT.PlayerState),e({status:"GameReady",payload:{play:()=>{s.player.playVideo()}}})),!0===s.isBGMStart&&t.data===YT.PlayerState.ENDED&&e({status:"GameCompleted",payload:{}})}}})}static play(){this.player.playVideo()}}class u{static _currentMode="";static get getCurrentMode(){return this._currentMode}static setCurrentMode(t){this._currentMode=t}static addKeyboardEventListener(){document.addEventListener("keydown",(t=>{switch(this._currentMode){case"":case"MainMenu":case"Loading":break;case"SelectBGM":n.onBGMSelected(t);break;case"GamePlaying":c.onkeypress(t)}}))}}window.onload=async()=>{e.setDebugMode("debug");const t=new e({filename:"MainPlayer"});t.log("Start"),o.initialize(),await i.initialize(),await n.initialize(),await d.initialize(),c.initialize(),t.log(n.getBGMListInfo()),u.setCurrentMode("GamePlaying"),u.addKeyboardEventListener(),document.oncontextmenu=e=>{t.log("Right click"),e.preventDefault()},document.onclick=async t=>{console.log(t),d.setVideo("두근두근! 드디어!! 대모험 시작!!!",(({status:t,payload:e})=>{"GameReady"===t&&(c.start(),e.play())}))}}})();