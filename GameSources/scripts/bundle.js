(()=>{"use strict";class t{constructor({filename:t}){this.filename=t}getFormattedDate(){const t=new Date;return`[${t.getFullYear()}/${("00"+(t.getMonth()+1)).substr(-2)}/${("00"+t.getDate()).substr(-2)} ${("00"+(t.getHours()+1)).substr(-2)}:${("00"+(t.getMinutes()+1)).substr(-2)}:${("00"+(t.getSeconds()+1)).substr(-2)}]`}log(...t){const e=`                         ${this.filename}`.substr(-20);console.log(`${this.getFormattedDate()}[${e}] `,...t)}}const e=new t({filename:"BGMDatabase"});class s{static BGMDataList={};static player;static async initialize(){try{e.log("Initializing..."),this.BGMDataList=await(await fetch("data/BGMList.json")).json();for(let t=0;t<this.BGMDataList.length;t++){const s=this.BGMDataList[t];this.BGMDataList[t].coverImage=this.getCoverImage(s.title);const i=await(await fetch(`data/notes/${s.title}.json`)).json();this.BGMDataList[t].data.noteList=i,e.log(`Loading [${s.title}]...`)}e.log("BGM Data : ",this.BGMDataList)}catch(t){e.error(t)}}static getCoverImage(t){return`data/coverImages/${t}.png`}static getDataByTitle(t){for(const e of this.BGMDataList)if(e.title===t)return e;return null}static getDataByIndex(t){return this.BGMDataList[t]}}const i=new t({filename:"BGMSelector"});class a{static selectedIdx=0;static BGMData={};static async initialize(){i.log("Initializing..."),this.BGMData=await(await fetch("data/BGMList.json")).json();for(const t in this.BGMData)this.BGMData[t].coverImage=s.getCoverImage(t)}static getBGMListInfo(){return this.BGMData}static onBGMSelected(t){"ArrowLeft"===t.key?(this.selectedIdx=(this.BGMData.length+this.selectedIdx-1)%this.BGMData.length,i.log(`Selected title : [${this.selectedIdx}] ${this.BGMData[this.selectedIdx].title}`)):"ArrowRight"===t.key?(this.selectedIdx=(this.selectedIdx+1)%this.BGMData.length,i.log(`Selected title : [${this.selectedIdx}] ${this.BGMData[this.selectedIdx].title}`)):"Enter"!==t.key&&" "!==t.key||i.log("Selected")}}const n=new t({filename:"NoteCreator"});class o{static Difficulty={EASY:"Easy",NORMAL:"Normal",HARD:"Hard"};static currentDifficulty="";static MUSIC_NOTE_CLASS_NAME="MUSIC_NOTE";static PRESSED_CLASS_NAME="PRESSED_NOTE";static MAX_KEYPRESS_NOTES=100;static KEYPRESS_FPS=1e3/this.MAX_KEYPRESS_NOTES;static currentNoteIndex=0;static currentKeyPressNoteIndex=0;static NOTE_SPEED=2;static NOTE_ACTIVATING_TIMESTAMP=1300;static NOTE_SHOWING_TIMESTAMP=1e3*this.NOTE_SPEED;static NOTE_CHECK_DELAY_TIMESTAMP=1200;static keypressDivInterval;static isPaused=!1;static noteList=[];static musicNoteList=[];static keypressNotes=[];static timeoutFunctionList=[];static activateNoteList=[];static keynotesContainer=null;static pressedkeynotesContainer=null;static StartTime=null;static NOTE_STATUS={IDLE:"Idle",SHOWING:"Showing",ACTIVATING:"Activating",USED:"Used"};static PointCheck={Perfect:0,Good:0,Bad:0,Miss:0};static initialize(){n.log("Initializing..."),this.keynotesContainer=document.getElementById("keynotesContainer"),this.pressedkeynotesContainer=document.getElementById("keynotePressedContainer"),this.createkeypressNotes()}static getCurrentNoteIndex(){return this.currentNoteIndex=++this.currentNoteIndex%this.MAX_KEYPRESS_NOTES,this.currentNoteIndex}static getCurrentKeyPressNoteIndex(){return this.currentKeyPressNoteIndex=++this.currentKeyPressNoteIndex%this.MAX_KEYPRESS_NOTES,this.currentKeyPressNoteIndex}static getCurrentDifficulty(){return this.currentDifficulty}static setNotes(t,e){n.log(`Set notes for title : [${e}][${t}]...`),this.noteList=s.getDataByTitle(t).data.noteList[e];for(let t=0;t<this.noteList.length;t++)this.noteList[t].status=this.NOTE_STATUS.IDLE;this.currentDifficulty=e,document.getElementById("Difficulty").innerHTML=`Difficulty : ${e}`,n.log("Notes : ",this.noteList)}static createkeypressNotes(){for(let t=0;t<this.MAX_KEYPRESS_NOTES;t++){const e=document.createElement("div");e.id=`musicNote_${t}`,e.setAttribute("class",this.MUSIC_NOTE_CLASS_NAME),this.keynotesContainer.appendChild(e);const s=document.createElement("div");s.id=`keypressNote_${t}`,s.setAttribute("class",this.PRESSED_CLASS_NAME),this.pressedkeynotesContainer.appendChild(s)}}static add({what:t,timestamp:e}){}static read(){}static create(){}static pop(){this.StartTime.getTime(),(new Date).getTime()}static async start(){const t=this;n.log("Start to create notes..."),n.log(`Note create delay : ${t.NOTE_CHECK_DELAY_TIMESTAMP}`),this.setNotes("두근두근! 드디어!! 대모험 시작!!!",this.Difficulty.NORMAL);for(const e of this.noteList)(e=>{n.log(`Note show timestamp : ${e.timestamp} - ${t.NOTE_CHECK_DELAY_TIMESTAMP}`),this.timeoutFunctionList.push(setTimeout((()=>{this.renderMusicNote(e.key),n.log(`Showing note : ${e.key}`),e.status=t.NOTE_STATUS.SHOWING,setTimeout((()=>{n.log(`Activate note : ${e.key} / ${t.NOTE_ACTIVATING_TIMESTAMP}`),e.status=t.NOTE_STATUS.ACTIVATING}),t.NOTE_ACTIVATING_TIMESTAMP),setTimeout((()=>{n.log(`Used note : ${e.key}`),e.status=t.NOTE_STATUS.USED}),t.NOTE_SHOWING_TIMESTAMP)}),e.timestamp-t.NOTE_CHECK_DELAY_TIMESTAMP))})(e);this.StartTime=new Date}static stop(){this.noteList=[];for(const t of this.timeoutFunctionList)clearTimeout(t)}static renderMusicNote(t){const e=this;(t=>{const s=document.getElementById(`musicNote_${this.getCurrentNoteIndex()}`);s.innerText=t,s.setAttribute("class",`${this.MUSIC_NOTE_CLASS_NAME} showNote`),setTimeout((()=>{s.setAttribute("class",`${this.MUSIC_NOTE_CLASS_NAME}`),s.innerText=""}),e.NOTE_SHOWING_TIMESTAMP)})(t)}static keypressNote(t){(t=>{const e=document.getElementById(`keypressNote_${this.getCurrentKeyPressNoteIndex()}`);e.innerText=t,e.setAttribute("class",`${this.PRESSED_CLASS_NAME} showNote`),this.checkPressedKeyCorrected(t),setTimeout((()=>{e.setAttribute("class",`${this.PRESSED_CLASS_NAME}`),e.innerText=""}),1e3)})(t)}static checkPressedKeyCorrected(t){const e=(new Date).getTime()-this.StartTime;n.log(`Key pressed ${t} with timestamp : ${e}`),this.currentKeyPressNoteIndex}static onkeypress(t){1===t.key.length&&this.keypressNote(t.key)}}const r=new t({filename:"BGMPlayer"});class c{static currentBGM="";static isBGMStart=!1;static player;static Containers={Difficulty:null,GetReadyText:null,keynotesContainerBackground:null,keynoteChecker:null};static initialize(){this.Containers.Difficulty=document.getElementById("Difficulty"),this.Containers.GetReadyText=document.getElementById("getReadyText"),this.Containers.keynotesContainerBackground=document.getElementById("keynotesContainerBackground"),this.Containers.keynoteChecker=document.getElementById("keynoteChecker")}static async setVideo(t){const e=this;return new Promise(((i,a)=>{r.log(`SetVideo : [${t}]`);const n=s.getDataByTitle(t);r.log(n),e.player=new YT.Player("youtubeVideoPlayer",{height:"800",width:"800",videoId:n.data.youtube,playerVars:{controls:0},events:{onReady:function(t){e.player.playVideo()},onStateChange:async function(t){!1===e.isBGMStart&&(r.log("self.isBGMStart ",e.isBGMStart),e.isBGMStart=!0,e.player.stopVideo(),await new Promise(((t,s)=>{e.Containers.GetReadyText.innerHTML="Get<br>Ready?",e.Containers.GetReadyText.setAttribute("class","GetReadyAnimation"),setTimeout((()=>{e.Containers.GetReadyText.setAttribute("class",""),e.Containers.GetReadyText.innerHTML="3",setTimeout((()=>{e.Containers.GetReadyText.setAttribute("class","GetReadyAnimation")}))}),1e3),setTimeout((()=>{e.Containers.GetReadyText.setAttribute("class",""),e.Containers.GetReadyText.innerHTML="2",setTimeout((()=>{e.Containers.GetReadyText.setAttribute("class","GetReadyAnimation")}))}),2e3),setTimeout((()=>{e.Containers.GetReadyText.setAttribute("class",""),e.Containers.GetReadyText.innerHTML="1",setTimeout((()=>{e.Containers.GetReadyText.setAttribute("class","GetReadyAnimation")}))}),3e3),setTimeout((()=>{e.Containers.GetReadyText.setAttribute("class",""),e.Containers.GetReadyText.innerHTML="Start!",setTimeout((()=>{e.Containers.GetReadyText.setAttribute("class","GetReadyAnimation")}))}),4e3),setTimeout((()=>{const s=e.Containers.keynotesContainerBackground.getAttribute("class"),i=e.Containers.keynoteChecker.getAttribute("class");e.Containers.keynotesContainerBackground.setAttribute("class",`${s} transparentFadeIn`),e.Containers.keynoteChecker.setAttribute("class",`${i} transparentFadeIn`),e.Containers.Difficulty.style.opacity=1,setTimeout((()=>{e.Containers.keynotesContainerBackground.style.opacity=.2,e.Containers.keynoteChecker.style.opacity=.2})),e.Containers.GetReadyText.setAttribute("class",""),e.Containers.GetReadyText.innerHTML="",t()}),5e3)})),i({play:()=>{e.player.playVideo()}}))}}})}))}static play(){this.player.playVideo()}}class l{static _currentMode="";static get getCurrentMode(){return this._currentMode}static setCurrentMode(t){this._currentMode=t}static addKeyboardEventListener(){document.addEventListener("keydown",(t=>{switch(this._currentMode){case"":case"MainMenu":case"Loading":break;case"SelectBGM":a.onBGMSelected(t);break;case"GamePlaying":o.onkeypress(t)}}))}}window.onload=async()=>{const e=new t({filename:"MainPlayer"});e.log("Start"),await s.initialize(),await a.initialize(),await c.initialize(),o.initialize(),e.log(a.getBGMListInfo()),l.setCurrentMode("GamePlaying"),l.addKeyboardEventListener(),document.onclick=async()=>{const t=await c.setVideo("두근두근! 드디어!! 대모험 시작!!!");o.start(),t.play()}}})();